 #  20230324私有化部署详情



## 一、服务变更列表及镜像版本

"ota-file:master-ea8b8dff-3837"
"ota-personnel:master-ea8b8dff-3837"
"ota-property:master-ea8b8dff-3837"
"ota-management-ui:main-260d0366-3857"
"reverse-proxy:master-5f26b7ac-3876"

 

## 二、nacos 配置变更

**1、base.yaml**

新增：

```yaml
#无缩进
spring: 
  #缩进2个英文空格
  liquibase: 
    #缩进4个英文空格
    change-log: classpath:/liquibase/master.xml
    enabled: true
    
```

**2、file-prod.yaml**

新增

```yaml
#无缩进
oss:
  #缩进2个英文空格
  readOnly:
    #缩进4个英文空格
    accessKeyId: 可以是读写账号，也可以是只读账号
    accessKeySecret: ****
    out-endpoint: https://oss-cn-beijing.aliyuncs.com  #请替换图森oss外网地址
#无缩进
upload:
  #缩进2个英文空格
  timeout: 20
```

**3、property-prod.yaml**

新增

```yaml
#无缩进
device:
  #缩进2个英文空格
  file:
    #缩进4个英文空格
    config:
      #缩进6个英文空格
      can:
        #缩进8个英文空格
        name: CAN 日志
        path: /data/log/can/
      #缩进6个英文空格  
      ota:
        #缩进8个英文空格
        name: OTA 日志
        path: /data/ota_client/log/inchtek_ota_client/
```



## 三、冒烟测试

| 用例名称      | 测试步骤                                                     | 期望结果                                                     |
| ------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 管理 CAN 日志 | 1、点击“运维配置”界面中“日志采集”标签页；<br/>2、编辑"CAN日志"，在对话框中输入正确的日志路径，点击保存返回；<br/>3、点击“网关日志”->"CAN日志"，在左侧“网关列表”中查看网关列表，双击任一在线网关的序列号，查看日志列表；<br/>4、点击日志列表中任意一条数据中的“同步到云端”按钮；<br/>5、点击“同步任务管理”页面，双击左侧网关列表中任意一个网关，选择对应的文件进行下载； | 1、步骤2中，“日志类别”和“是否开启”不可修改，只允许修改“日志路径”，点击“保存”返回成功；<br/>2、步骤3中，用户仅能访问到所属车队下的网关列表；<br/>3、步骤3中，用户查看到的网关列表是按照在线状态进行排序的，在线网关在前，离线网关在后；<br/>4、步骤3中，用户双击在线网关序列号，右侧可以显示出当前网关中的CAN日志文件，可以查看到文件名、文件更新时间、文件类型、文件大小、文件最后一次同步时间；<br/>5、步骤4中，点击“同步到云端”按钮后，在“同步任务管理”页可以查看到对应的同步任务；<br/>6、步骤4可以多次执行，即允许创建多条同步任务，非第一次同步时创建任务，会提示“已存在同步记录，是否继续同步？”的对话框；<br/>7、步骤5中，进入“同步任务管理”页面时，显示所有网关的同步任务，日志类别选择CAN 日志过滤，只显示CAN日志同步任务；<br/>8、步骤5中，双击某个网关时，只显示该网关下中的文件同步任务；<br/>9、步骤5中，点击下载后，浏览器会弹出下载任务创建对话框并创建浏览器下载任务； |
| 管理 OTA 日志 | 1、点击“运维配置”界面中“日志采集”标签页；<br/>2、编辑"OTA日志"，在对话框中输入正确的日志路径，点击保存返回；<br/>3、点击“网关日志”->"OTA日志"，在左侧“网关列表”中查看网关列表，双击任一在线网关的序列号，查看日志列表；<br/>4、点击日志列表中任意一条数据中的“同步到云端”按钮；<br/>5、点击“同步任务管理”页面，双击左侧网关列表中任意一个网关，选择对应的文件进行下载； | 1、步骤2中，“日志类别”和“是否开启”不可修改，只允许修改“日志路径”，点击“保存”返回成功；<br/>2、步骤3中，用户仅能访问到所属车队下的网关列表；<br/>3、步骤3中，用户查看到的网关列表是按照在线状态进行排序的，在线网关在前，离线网关在后；<br/>4、步骤3中，用户双击在线网关序列号，右侧可以显示出当前网关中的OTA日志文件，可以查看到文件名、文件更新时间、文件类型、文件大小；<br/>5、步骤4中，点击“同步到云端”按钮后，在“同步任务管理”页可以查看到对应的同步任务；<br/>6、步骤4可以多次执行，即允许创建多条同步任务，非第一次同步时创建任务，会提示“已存在同步记录，是否继续同步？”的对话框；<br/>7、步骤5中，进入“同步任务管理”页面时，显示所有网关的同步任务，日志类别选择OTA 日志过滤，只显示OTA 日志同步任务；<br/>8、步骤5中，双击某个网关时，只显示该网关下中的文件同步任务；<br/>9、步骤5中，点击下载后，浏览器会弹出下载任务创建对话框并创建浏览器下载任务； |
| 管理其他日志  | 1、点击“运维配置”界面中“日志采集”标签页；<br/>2、点击"新增日志类别"按钮，在对话框中输入正确的日志路径，点击添加返回；<br/>3、点击“网关日志”-页面；<br/>4、在“网关日志”界面，点击新增的日志类别名称标签页，查看日志列表，双击任一在线网关的序列号，查看日志列表；<br/>5、点击日志列表中任意一条数据中的“同步到云端”按钮；<br/>6、点击“同步任务管理”页面，双击左侧网关列表中任意一个网关，选择对应的文件进行下载； | 1、步骤4中，用户仅能访问到所属车队下的网关列表；<br/>2、步骤4中，用户查看到的网关列表是按照在线状态进行排序的，在线网关在前，离线网关在后；<br/>3、步骤4中，用户双击在线网关序列号，右侧可以显示出当前网关中的该日志类别的日志文件，可以查看到文件名、文件更新时间、文件类型、文件大小；<br/>5、步骤5中，点击“同步到云端”按钮后，在“同步任务管理”页可以查看到对应的同步任务；<br/>6、步骤6可以多次执行，即允许创建多条同步任务，非第一次同步时创建任务，会提示“已存在同步记录，是否继续同步？”的对话框；<br/>7、步骤6中，进入“同步任务管理”页面时，显示所有网关的同步任务，通过日志类别过滤可以只显示OTA日志同步任务；<br/>8、步骤6中，双击某个网关时，只显示该网关下中的文件同步任务；<br/>9、步骤6中，点击下载后，浏览器会弹出下载任务创建对话框并创建浏览器下载任务； |
| 同步任务管理  | 1、点击“网关日志 ”->“同步任务管理”标签页；<br/>2、双击左侧网关列表中任一网关，查看右侧同步任务记录；<br/>3、选择任意一个已经完成同步的任务，点击"下载"按钮；<br/>4、选择任意一个未未完成或者失败的任务，点击“下载”按钮；<br/>5、选择任意一个同步任务，点击“删除”按钮； | 1、在步骤2中，可以查看在线车辆和离线车辆的同步任务记录；<br/>2、在步骤2中，如果某个车辆没有同步记录，显示“该车辆暂无同步记录”提示语，提示语在页面显示；<br/>3、在步骤3中，文件可以通过浏览器创建下载任务并下载成功；<br/>4、在步骤4中，“下载”按钮不可用，无法下载；<br/>5、在步骤5中，任意的同步任务，均可以删除成功，包括未完成、已完成、失败的任务，删除成功后，页面自动刷新，不再显示已删除的任务；<br/>6、在步骤7之后，网关端会更新成最新的证书文件； |

